<!DOCTYPE html>
<html>
<head>
    <title>Bogobit</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="/images/favicon.png" type="image/x-icon">
</head>
<body data-total-comments="{{page.totalComments}}" data-current-page="{{data.currentPage}}" data-last-page="{{data.lastPage}}">
    <h1>Comments</h1>
    {{> navbar}}

    <p id="comment-info"></p>
    <!-- Display all comments in an unordered list -->
    <ul class="comment-list">
        {{#each comments}}
            <li>
                <p>
                    <strong id="comment-author" style="color: #{{name_color}}">{{display_name}}</strong>
                    <div class="list-indent">
                        {{text}}<br>
                        <em class="comment-date">Posted on: {{created_at}}</em><br>
                    </div>
                </p>
            </li>
        {{/each}}
    </ul>

    <!-- If user is logged in, add comment form, else send to login -->
    {{#if user.isLoggedIn}}
        <form class="themed-form" action="/comment/new" method="GET">
            <button class="themed-button" type="submit">Add Comment</button>
        </form>
    {{else}}
        <form class="themed-form" action="/login" method="GET">
            <button class="themed-button" type="submit">Add Comment</button>
        </form>
    {{/if}}

    <span class="pagination-container">
        <!-- Previous page -->
        {{#if page.prevPage}}
            <form action="/comments" method="GET">
                <input type="hidden" name="page" value="{{page.prevPage}}">
                <button class="themed-button" type="submit">&lt;</button>
            </form>
        {{/if}}

        <!-- Current Page -->
        <form action="/comments" method="GET">
            <input type="hidden" name="page" value="{{page.currentPage}}">
            <button class="current-page-button" type="submit">{{page.currentPage}}</button>
        </form>

        <!-- Display next five pages as quick buttons -->
        {{#if page.index}}
            {{#each page.index}}
                <form action="/comments" method="GET">
                    <input type="hidden" name="page" value="{{this}}">
                    <button class="page-button" type="submit">{{this}}</button>
                </form>
            {{/each}}
        {{/if}}
        ...
        <!-- Last Page -->
        {{#if page.nextPage}}
            <form action="/comments" method="GET">
                <input type="hidden" name="page" value="{{page.lastPage}}">
                <button class="page-button" type="submit">{{page.lastPage}}</button>
            </form>
        {{/if}}

        <!-- Next page -->
        {{#if page.nextPage}}
            <form action="/comments" method="GET">
                <input type="hidden" name="page" value="{{page.nextPage}}">
                <button class="themed-button" type="submit">&gt;</button>
            </form>
        {{/if}}
        &nbsp;&nbsp;&nbsp;
        <!-- Manual page number -->
        <form action="/comments" method="GET">
            <input type="number" id="manual-page" name="page" min="1" step="1" required>
            <button class="themed-button" type="submit">Go</button>
        </form>
    </span>

    {{> footer}}
    <script>
        const PAGE_SIZE = 20;
        const totalComments = document.body.dataset.totalComments;  
        const currentPage = document.body.dataset.currentPage;  
        const lowerPageBound = PAGE_SIZE * currentPage - 1;
        const upperPageBound = (lowerPageBound + PAGE_SIZE > totalComments) ? totalComments : lowerPageBound + PAGE_SIZE;

        
        const lastPage = document.body.dataset.lastPage;

        const commentInfo = document.getElementById('comment-info');
        commentInfo.textContent = `Comments ${lowerPageBound}-${upperPageBound} of ${totalComments}`
    </script>
</body>
</html>


